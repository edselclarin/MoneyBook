<Window x:Class="MoneyBook2.Views.MainView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:MoneyBook2.Views"
        xmlns:viewModels="clr-namespace:MoneyBook2.ViewModels"
        local:CursorHelper.Cursor="{Binding CurrentCursor}"
        Title="MoneyBook" Height="695" Width="1000"
        Background="#FF505050"
        WindowStartupLocation="CenterScreen">
    <Window.DataContext>
        <viewModels:MainViewModel/>
    </Window.DataContext>
    
    <Window.Resources>
        <!-- Accounts Table Style -->
        <Style x:Key="AccountsListViewItemStyle" TargetType="ListViewItem">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="{StaticResource DarkDimGray}"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="Padding" Value="2"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource SoftTransparentBlack}"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource SoftTransparentBlack}"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
                <Trigger Property="IsKeyboardFocusWithin" Value="True">
                    <Setter Property="Background" Value="{StaticResource SoftTransparentBlack}"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Dues Table Style -->
        <Style x:Key="DuesListViewItemStyle" TargetType="ListViewItem">
            <Setter Property="Foreground" Value="{Binding DueState, Converter={StaticResource DueStateTypesToForegroundConverter}}"/>
            <Setter Property="Background" Value="{StaticResource DarkDimGray}"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="Padding" Value="2"/>
            <Style.Triggers>
                <Trigger Property="IsKeyboardFocusWithin" Value="True">
                    <Setter Property="Background" Value="{StaticResource SoftTransparentBlack}"/>
                    <Setter Property="Foreground" Value="{Binding DueState, Converter={StaticResource DueStateTypesToForegroundConverter}}"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource SoftTransparentBlack}"/>
                    <Setter Property="Foreground" Value="{Binding DueState, Converter={StaticResource DueStateTypesToForegroundConverter}}"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource SoftTransparentBlack}"/>
                    <Setter Property="Foreground" Value="{Binding DueState, Converter={StaticResource DueStateTypesToForegroundConverter}}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

    </Window.Resources>

    <!-- Shortcut Keys -->
    <Window.InputBindings>
        <KeyBinding Key="F5" Command="{Binding RefreshViewCommand}" />
    </Window.InputBindings>

    <!-- Body -->
    <Grid x:Name="RootGrid" 
          Margin="5"
          IsEnabled="{Binding IsRefreshing, Converter={StaticResource InverseBooleanConverter}}">
        
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="450"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Accounts Table -->
        <GroupBox Grid.Row="0"
                  Grid.Column="0"
                  Width="450"
                  BorderThickness="0"
                  HorizontalAlignment="Left"
                  Margin="0 0 0 10">
            <GroupBox.Header>
                <TextBlock Text="Accounts"
                           Style="{StaticResource LargeTextBlockStyle}"
                           FontWeight="Bold"
                           Foreground="White"
                           Margin="0 0 0 7"/>
            </GroupBox.Header>
            <ListView HorizontalAlignment="Left"
                      Background="{StaticResource DarkDimGray}"
                      ItemsSource="{Binding Accounts}"
                      SelectionMode="Single"
                      local:ListViewSelectedItemsBehavior.SelectedItems="{Binding SelectedAccounts}">
                <ListView.View>
                    <GridView>
                        <GridViewColumn Header="Name" 
                                        Width="150"
                                        HeaderContainerStyle="{StaticResource LeftJustifiedGridViewColumnHeaderStyle}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Name}"
                                               Style="{StaticResource MediumTextBlockStyle}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <GridViewColumn Header="Available" 
                                        Width="90"
                                        HeaderContainerStyle="{StaticResource RightJustifiedGridViewColumnHeaderStyle}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding AvailableBalance}"
                                               Style="{StaticResource MediumTextBlockStyle}"
                                               TextAlignment="Right"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <GridViewColumn Header="Due" 
                                        Width="90"
                                        HeaderContainerStyle="{StaticResource RightJustifiedGridViewColumnHeaderStyle}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding TotalDues}"
                                               Style="{StaticResource MediumTextBlockStyle}"
                                               TextAlignment="Right"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <GridViewColumn Header="Remaining" 
                                        Width="90"
                                        HeaderContainerStyle="{StaticResource RightJustifiedGridViewColumnHeaderStyle}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding RemainingBalance}"
                                               Style="{StaticResource MediumTextBlockStyle}"
                                               TextAlignment="Right"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                    </GridView>
                </ListView.View>
                <ListView.ContextMenu>
                    <ContextMenu DataContext="{Binding Path=PlacementTarget, RelativeSource={RelativeSource Self}}">
                        <MenuItem Header="Transactions" 
                                  ToolTip="Open transactions window"
                                  Command="{Binding Path=DataContext.OpenTransactionsViewCommand}"
                                  CommandParameter="{Binding Path=SelectedItems}" />
                    </ContextMenu>
                </ListView.ContextMenu>
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem" 
                           BasedOn="{StaticResource AccountsListViewItemStyle}">
                        <EventSetter Event="PreviewMouseRightButtonDown"
                                     Handler="ListViewItem_PreviewMouseRightButtonDown"/>
                    </Style>
                </ListView.ItemContainerStyle>
            </ListView>
        </GroupBox>

        <StackPanel Grid.Row="0"
                    Grid.Column="1"
                    Orientation="Vertical"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Top"
                    Margin="0 25 0 0">
            <Button Content="Import Transactions"
                    Height="30"
                    Width="120"
                    Margin="5"
                    Command="{Binding ImportTransactionsCommand}"/>
            <Button Content="Backup Database"
                    Height="30"
                    Width="120"
                    Margin="5"
                    Command="{Binding BackupDatabaseCommand}"/>
            <Button Content="Restore Database"
                    Height="30"
                    Width="120"
                    Margin="5"
                    Command="{Binding RestoreDatabaseCommand}"/>
        </StackPanel>

        <!-- Dues Table-->
        <GroupBox Grid.Row="1"
                  Grid.Column="0"
                  Grid.ColumnSpan="2"
                  BorderThickness="0"
                  HorizontalAlignment="Left"
                  Margin="0 0 0 10">
            <GroupBox.Header>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Dues"
                               Style="{StaticResource LargeTextBlockStyle}"
                               FontWeight="Bold"
                               Foreground="White"
                               Margin="0 0 0 7"/>
                    <Border Width="20"/>
                    <StackPanel Orientation="Horizontal"
                                Margin="0 3 0 0">
                        <TextBlock VerticalAlignment="Top"
                                   Style="{StaticResource HyperlinkTextBlock}">
                            <Hyperlink ToolTip="Uncheck all dues" 
                                       Style="{StaticResource HyperlinkHighlightStyle}"
                                       Command="{Binding DataContext.UncheckAllDuesCommand, ElementName=RootGrid}">
                                Uncheck All
                            </Hyperlink>
                        </TextBlock>
                        <TextBlock VerticalAlignment="Top"
                                   Style="{StaticResource HyperlinkTextBlock}"
                                   Visibility="Collapsed"> // Hide for now
                            <Hyperlink ToolTip="Deselect dues" 
                                       Style="{StaticResource HyperlinkHighlightStyle}"
                                       Command="{Binding DataContext.DeselectDuesCommand, ElementName=RootGrid}">
                                <Run Text="{Binding SelectedCount, Converter={StaticResource TextWithCountConverter}, ConverterParameter=Deselect}"/>
                            </Hyperlink>
                        </TextBlock>
                        <TextBlock VerticalAlignment="Top"
                                   Style="{StaticResource HyperlinkTextBlock}"
                                   Visibility="Collapsed"> // Hide for now
                            <Hyperlink ToolTip="Skip selected due(s)"
                                       Style="{StaticResource HyperlinkHighlightStyle}"
                                       Command="{Binding DataContext.SkipDueCommand, ElementName=RootGrid}">
                                <Run Text="{Binding SelectedCount, Converter={StaticResource TextWithCountConverter}, ConverterParameter=Skip}"/>
                            </Hyperlink>
                        </TextBlock>
                        <TextBlock VerticalAlignment="Top"
                                   Style="{StaticResource HyperlinkTextBlock}"
                                   Visibility="Collapsed"> // Hide for now
                            <Hyperlink ToolTip="Delete selected due(s)"
                                       Style="{StaticResource HyperlinkHighlightStyle}"
                                       Command="{Binding DataContext.DeleteDueCommand, ElementName=RootGrid}">
                                <Run Text="{Binding SelectedCount, Converter={StaticResource TextWithCountConverter}, ConverterParameter=Delete}"/>
                            </Hyperlink>
                        </TextBlock>
                        <TextBlock VerticalAlignment="Top"
                                   Style="{StaticResource HyperlinkTextBlock}"
                                   Visibility="Collapsed"> // Hide for now
                            <Hyperlink ToolTip="Create a due" 
                                       Style="{StaticResource HyperlinkHighlightStyle}"
                                       Command="{Binding DataContext.CreateDueCommand, ElementName=RootGrid}">
                                Create
                            </Hyperlink>
                        </TextBlock>
                        <TextBlock VerticalAlignment="Top"
                                   Style="{StaticResource HyperlinkTextBlock}"
                                   Visibility="Collapsed"> // Hide for now
                            <Hyperlink ToolTip="Modify selected due"
                                       Style="{StaticResource HyperlinkHighlightStyle}"
                                       Command="{Binding DataContext.EditDueCommand, ElementName=RootGrid}">
                                Edit
                            </Hyperlink>
                        </TextBlock>
                    </StackPanel>
                </StackPanel>
            </GroupBox.Header>
            <ListView HorizontalAlignment="Stretch"
                      Background="{StaticResource DarkDimGray}"                      
                      ItemsSource="{Binding Dues}"
                      SelectionMode="Multiple"
                      local:ListViewSelectedItemsBehavior.SelectedItems="{Binding SelectedDues}">
                <ListView.View>
                    <GridView>
                        <GridViewColumn Header="" 
                                        Width="30"
                                        HeaderContainerStyle="{StaticResource CenterJustifiedGridViewColumnHeaderStyle}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <CheckBox IsChecked="{Binding IsChecked}"
                                              Command="{Binding DataContext.ToggleSelectedDueCommand, ElementName=RootGrid}"
                                              CommandParameter="{Binding}"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <GridViewColumn Header="Account" 
                                        Width="100"
                                        HeaderContainerStyle="{StaticResource LeftJustifiedGridViewColumnHeaderStyle}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding AccountName}"
                                               Style="{StaticResource MediumTextBlockStyle}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <GridViewColumn Header="Due Date" 
                                        Width="80"
                                        HeaderContainerStyle="{StaticResource LeftJustifiedGridViewColumnHeaderStyle}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding DueDate, StringFormat={}{0:d}}"
                                               Style="{StaticResource MediumTextBlockStyle}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <GridViewColumn Header="Payee" 
                                        Width="250"
                                        HeaderContainerStyle="{StaticResource LeftJustifiedGridViewColumnHeaderStyle}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Payee}"
                                               Style="{StaticResource MediumTextBlockStyle}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <GridViewColumn Header="Memo" 
                                        Width="150"
                                        HeaderContainerStyle="{StaticResource LeftJustifiedGridViewColumnHeaderStyle}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Memo}"
                                               Style="{StaticResource MediumTextBlockStyle}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <GridViewColumn Header="Website" 
                                        Width="150"
                                        HeaderContainerStyle="{StaticResource LeftJustifiedGridViewColumnHeaderStyle}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Website}"
                                               Style="{StaticResource MediumTextBlockStyle}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <GridViewColumn Header="Frequency" 
                                        Width="80"
                                        HeaderContainerStyle="{StaticResource CenterJustifiedGridViewColumnHeaderStyle}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Frequency}"
                                               Style="{StaticResource MediumTextBlockStyle}"
                                               TextAlignment="Center"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <GridViewColumn Header="Amount" 
                                        Width="90"
                                        HeaderContainerStyle="{StaticResource RightJustifiedGridViewColumnHeaderStyle}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Amount}"
                                               Style="{StaticResource MediumTextBlockStyle}"
                                               TextAlignment="Right"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                    </GridView>
                </ListView.View>
                <ListView.ContextMenu>
                    <ContextMenu DataContext="{Binding Path=PlacementTarget, RelativeSource={RelativeSource Self}}">
                        <MenuItem Header="Skip" 
                                  ToolTip="Skip selected dues"
                                  Command="{Binding Path=DataContext.SkipSelectedDuesCommand}"
                                  CommandParameter="{Binding Path=SelectedItems}" />
                        <MenuItem Header="Delete" 
                                  ToolTip="Delete selected dues"
                                  Command="{Binding Path=DataContext.DeleteSelectedDuesCommand}"
                                  CommandParameter="{Binding Path=SelectedItems}" />
                        <Separator/>
                        <MenuItem Header="Edit" 
                                  ToolTip="Edit selected due"
                                  Command="{Binding Path=DataContext.EditSelectedDueCommand}"
                                  CommandParameter="{Binding Path=SelectedItems}" />
                        <Separator/>
                        <MenuItem Header="Open website" 
                                  ToolTip="Open website"
                                  Command="{Binding Path=DataContext.OpenWebsiteCommand}"
                                  CommandParameter="{Binding Path=SelectedItems}" />
                        <Separator/>
                        <MenuItem Header="Create" 
                                  ToolTip="Create a new due"
                                  Command="{Binding Path=DataContext.CreateNewDueCommand}"/>
                    </ContextMenu>
                </ListView.ContextMenu>
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem" 
                           BasedOn="{StaticResource DuesListViewItemStyle}">
                        <EventSetter Event="PreviewMouseRightButtonDown"
                                     Handler="ListViewItem_PreviewMouseRightButtonDown"/>
                    </Style>
                </ListView.ItemContainerStyle>
            </ListView>
        </GroupBox>
    </Grid>
</Window>
